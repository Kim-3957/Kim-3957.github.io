---
title: "칼만필터의 시작"  
excerpt: "튜토리얼 2"  
categories:  
  - Kalman
tags: [Kalman]
comments: true
---
# 칼만필터 (2)
칼만필터는 예측단계와 추정(업데이트) 두개의 시퀀스를 가지는 필터이다.  
그런데 사실 디테일하게 이야기 하자면 할게 좀더 남았다.  

>1. 대충 이전의 데이터를 가지고 다음에 들어올 입력값을 예상해놓는다 (예측단계)   
> **1.5 예측값의 분산의 계산 (공분간 계산단계)** 
>2. 입력이 들어왔다. (관측)
>3. 입력데이터와 예측데이터를 비교해서 최적의 출력값을 추정 (업데이트 단계)

이번 글에서는 

> **1.5 예측값의 분산의 계산 (공분간 계산단계)** 

에 대해서 이야기해 보겠다.  

# (공)분산이 뭔가요 먹는건가요?  
보통 분산하면 뭐가 떠오르는가 ?  
더쉽게 말하자면, 데이터의 산만한 정도이다.    
어떤 정밀한 기계도 측정/예측에는 반드시 오차가 따른다.    
이것은 왜냐하면 우리는 진치 (True Value) 를 알 수 없고, 불확실한 측정에 의해서 진짜값을 추정할 수 밖에 없는것이다.  
즉 어떠한 **노이즈가 발생한다**.  

주의하라  
지금 **우리는 측정이 아니라 모델에 의한 예측을 하는 단계이다.**  
칼만필터는 이것을 프로세스에 의한 노이즈 $$w$$ (Process noise) 라고 하고 모델안에 집어넣는다.  

> 왜 측정 오차가 아닌가요?

지금은 측정에 관한 노이즈가 아니라 예측치에 관한 노이즈를 생각하고 있기떄문에 프로세스 노이즈이다.  
프로세스 노이즈란, 간단히 말해서 우리가 만든 예측모델의 분산이다.  
만약 우리가 쓰고있는 CV 모델이, 그러니까 일정 속도로 계속 움직일 것이다라는 예측이 빗나가고 많은 오차를 포함한다면, 이 $$w$$  는 큰 값을 가질것이다.  

$$x_k = \Phi_{k-1}x_{k-1} + w_{k-1}$$

이러면 의문이 생길것이다.  
  
> 아니 우리가 그런 노이즈를 식안에 넣을 수 있으면 진작에 넣었지...
> 모델의 정확도를 모르니까 개고생하는거 아니야..

라고생각할 수있다.  
그래서 칼만씨는 이 노이즈 $$w$$ 를 가우시안 분포를 따른다고 가정을 했다.  
$$Q$$ 를 방금 이야기한 프로세스 노이즈가 따르는 분산이라고 하겠다.   
이걸 식으로 쓰면  

$$w_k \sim \mathcal{N}(0,Q_k)$$

$$\mathcal{N}$$ 요거는 가우시안을 따른다 라는 의미이고  
(평균값,분산값) 으로 표현을 한다.  

근데 여기서 지금까지 이야기한 분산을 공분산이라고 하는 경우도 있다.  
공분산은, 아까 정의한 상태공간벡터의 분산행렬이다.  
여기서는 데이터의 산만한정도를 표현하는 행렬이라고만 알아두자.   
먼저 피부로 느껴야한다. 

# 그래서 분산은 어떻게 계산하는데요? 

지금 여러분은 그것보다 분산이 3개 있다는 사실을 깨달아야한다.  

> ???

분산의 종류는 3가지다 여기서 적어놓겠다.
1. process noise (co)vaSriance  $$Q$$  
2. Measurement noise (co)variance  $$R$$
3. State (co)variance $$P$$

2 에대해서는 나중에 설명하겠다.  
제일 중요한것은  $$P$$ 이다.  

> $$P$$ 가 뭔데요

우리가 추정하는것이 무엇이였는지 생각해보자.  
진치를 알고싶은것이다.  
그걸워해서 위에서 여러가지 모델의 식을 세워왔다.  

$$P$$ 는 카르만 필터의 최종 추정치의 분산을 나타낸다.  
즉, 우리는 $$P$$ 가 최소가 되도록 우리들의 추정치와 예측치를 사용해서 최적의 추정값을 찾지 않으면 안된다.  
 

# 그래서 (공)분산은 어떻게 계산하는데요? 
